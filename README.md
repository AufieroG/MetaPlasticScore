# Metagenome---PlasticScore
Pipeline for computing a plastic degradation potential score from HMMER (hmmsearch) outputs and taxon normalized abundance tables.
PlasticScore

PlasticScore is an R-based pipeline for computing a PlasticScore from HMM search results and taxon abundance and metadata tables.

The pipeline integrates hmmsearch outputs generated using enzyme-specific HMM profiles with taxonomic abundance data and sample and taxon metadata. It produces per-sample PlasticScores, taxon × enzyme matrices, taxonomic contribution statistics, and multiple objects ready for downstream visualization and statistical analysis.

All identifiers (taxon IDs, sample names, etc.) must be consistent across all input files.

Input preparation

PlasticScore requires the following input files:

HMMER search output files (.tbl and .domtbl)

A taxon abundance table (CSV)

Sample metadata (CSV)

Taxonomic metadata (CSV)

HMMER search outputs

PlasticScore uses output files generated by hmmsearch with enzyme-specific HMM profiles.

File organization

All HMMER output files must be placed in a single directory (e.g. hmmsearch/).

Naming convention

Each file must follow this exact naming scheme:

<taxon_id>__<enzyme_id>.tbl
<taxon_id>__<enzyme_id>.domtbl


<taxon_id> must match the identifiers used in the abundance and taxonomy metadata files.

<enzyme_id> must correspond to the HMM model name.

HMM models for plastic-degrading enzymes can be stored, for example, in:

PlasticScore/HMMmodel/

Example hmmsearch command
hmmsearch \
  --cpu 1 \
  --domtblout output_dir/<taxon_id>__<enzyme_id>.domtbl \
  --tblout    output_dir/<taxon_id>__<enzyme_id>.tbl \
  -E 1e-5 \
  --incE 1e-3 \
  path/to/HMMmodel/<enzyme_id>.hmm \
  path/to/protein_sequences/<taxon_id>.faa

R requirements

The following R packages must be installed and loaded before running the pipeline:

library(stats)
library(utils)
library(ggplot2)
library(vegan)
library(tidyr)
library(ComplexHeatmap)
library(circlize)
library(grid)
library(ggrepel)
library(viridis)
library(RColorBrewer)
library(magrittr)
library(dplyr)

Running the PlasticScore pipeline

Example call to the main function run_PlasticScore():

df <- run_PlasticScore(
  hmmsearch_files = "path/hmmsearch/",
  abundance_csv = "path/Abbundance_simulated_low_variance.csv",
  metadata_groups_csv = "path/Metadata_groups.csv",
  metadata_taxa_csv = "path/Metadata_taxa.csv",
  min_hmm_coverage = 0.7,
  max_dom_bias = 0.1,
  enzymes_for_plastic = c("All"),
  method = "abundance",
  normalize_abundance = FALSE # FALSE = absolute counts; TRUE = TSS / relative
)


This function will:

Parse all HMMER output files in the specified directory

Read abundance and metadata CSV files

Filter HMM hits based on coverage and domain bias

Build the taxon × enzyme matrix

Compute PlasticScores per sample and associated statistics

Compute taxon-level contributions

Prepare objects for plotting

Main output objects

The run_PlasticScore() function returns a list containing (among others):

hits_filt          <- df$hits_filt
plastic_score      <- df$plastic_score
enzyme_load        <- df$enzyme_load
taxon_enzyme_mat   <- df$taxon_enzyme_mat
taxon_stats        <- df$taxon_stats
abundance          <- df$abundance
metadata_groups    <- df$metadata_groups
metadata_taxa      <- df$metadata_taxa
enzyme_by_sample   <- df$enzyme_by_sample
contrib_phylum_mat <- df$contrib_phylum_mat
phylum_enzyme_mat  <- df$phylum_enzyme_mat
df_phylum_enzyme   <- df$df_phylum_enzyme

Quick inspection of results
cat("---- filtered HMM hits ----\n")
print(head(hits_filt))

cat("\n---- PlasticScore per sample ----\n")
print(head(plastic_score))

cat("\n---- Enzyme load per taxon ----\n")
print(head(enzyme_load))

cat("\n---- Taxon x Enzyme matrix ----\n")
print(head(taxon_enzyme_mat))

cat("\n---- Taxon statistics ----\n")
print(head(taxon_stats))

cat("\n---- Abundance table ----\n")
print(head(abundance))

cat("\n---- Sample metadata ----\n")
print(head(metadata_groups))

cat("\n---- Taxonomic metadata ----\n")
print(head(metadata_taxa))

cat("\n---- Enzyme-by-sample matrix ----\n")
print(head(enzyme_by_sample))

cat("\n---- Phylum contributions matrix ----\n")
print(head(contrib_phylum_mat))

cat("\n---- Phylum x Enzyme matrix ----\n")
print(head(phylum_enzyme_mat))

cat("\n---- Long-format Phylum-Enzyme table ----\n")
print(head(df_phylum_enzyme))
